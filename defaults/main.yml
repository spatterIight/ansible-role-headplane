# SPDX-FileCopyrightText: 2025 spatterlight
#
# SPDX-License-Identifier: AGPL-3.0-or-later

---

# Project source code URL: https://github.com/tale/headplane

headplane_enabled: true

headplane_identifier: headplane

headplane_uid: ''
headplane_gid: ''

# renovate: datasource=docker depName=ghcr.io/tale/headplane versioning=semver
headplane_version: 0.6.1
headplane_arch: amd64

# The hostname at which headplane is served.
headplane_hostname: ''

# The hostname at which headscale is served
headplane_headscale_hostname: headscale
headplane_headscale_port: 8080

# The secret used to encode and decode web sessions
# Ensure that this is exactly 32 characters long
#
# Generate with `pwgen -s 32 1` or in another way
headplane_cookie_secret: ''

# The path at which headplane is served.
# This value must either be `/` or not end with a slash (e.g. `/headplane`).
headplane_path_prefix: /

headplane_base_path: "{{ headplane_identifier }}"
headplane_data_path: "{{ headplane_base_path }}/data"

headplane_container_image: "{{ headplane_container_image_registry_prefix }}tale/headplane:{{ headplane_container_image_tag }}"
headplane_container_image_tag: "{{ headplane_version }}"
headplane_container_image_registry_prefix: ghcr.io/
headplane_container_image_force_pull: "{{ headplane_container_image.endswith(':latest') }}"

# The base container network. It will be auto-created by this role if it doesn't exist already.
headplane_container_network: "{{ headplane_identifier }}"

# A list of additional container networks that the container would be connected to.
# The role does not create these networks, so make sure they already exist.
headplane_container_additional_networks: "{{ (headplane_container_additional_networks_default + headplane_container_additional_networks_auto + headplane_container_additional_networks_custom) | unique }}"
headplane_container_additional_networks_default: []
headplane_container_additional_networks_auto: []
headplane_container_additional_networks_custom: []

# Controls how long to wait for the container to stop gracefully before killing it.
# Because `devture_systemd_docker_base_container_stop_grace_time_seconds` may be quite short and databases are more important to stop gracefully,
# we default to at least 30 seconds.
headplane_container_stop_grace_time_seconds: "{{ [devture_systemd_docker_base_container_stop_grace_time_seconds, 30] | max }}"

# List of systemd services that the Headplane systemd service depends on
headplane_systemd_required_services_list: "{{ (headplane_systemd_required_services_list_default + headplane_systemd_required_services_list_auto + headplane_systemd_required_services_list_custom) | unique }}"
headplane_systemd_required_services_list_default: "{{ [devture_systemd_docker_base_docker_service_name] if devture_systemd_docker_base_docker_service_name else [] }}"
headplane_systemd_required_services_list_auto: []
headplane_systemd_required_services_list_custom: []

# List of systemd services that the Headplane systemd service wants
headplane_systemd_wanted_services_list: "{{ (headplane_systemd_wanted_services_list_default + headplane_systemd_wanted_services_list_auto + headplane_systemd_wanted_services_list_custom) | unique }}"
headplane_systemd_wanted_services_list_default: []
headplane_systemd_wanted_services_list_auto: []
headplane_systemd_wanted_services_list_custom: []

# The port Headplane is running the WebUI on inside the container
headplane_container_http_port: 3000

# Controls whether the container exposes the HTTP WebUI port
# Can be used to access the HTTP WebUI directly (bypassing Traefik)
#
# Takes an "<ip>:<port>" or "<port>" value (e.g. "127.0.0.1:8080"), or empty string to not expose.
headplane_container_http_bind_port: ""

# To inject your own other container labels, see `headplane_container_labels_additional_labels`.
headplane_container_labels_traefik_enabled: true
headplane_container_labels_traefik_docker_network: "{{ headplane_container_network }}"
headplane_container_labels_traefik_hostname: "{{ headplane_hostname }}"
# The path prefix must either be `/` or not end with a slash (e.g. `/headplane`).
headplane_container_labels_traefik_path_prefix: "{{ headplane_path_prefix }}"
headplane_container_labels_traefik_rule: "Host(`{{ headplane_container_labels_traefik_hostname }}`){% if headplane_container_labels_traefik_path_prefix != '/' %} && PathPrefix(`{{ headplane_container_labels_traefik_path_prefix }}`){% endif %}"
headplane_container_labels_traefik_priority: 0
headplane_container_labels_traefik_entrypoints: web-secure
headplane_container_labels_traefik_tls: "{{ headplane_container_labels_traefik_entrypoints != 'web' }}"
headplane_container_labels_traefik_tls_certResolver: default  # noqa var-naming

# headplane_container_labels_additional_labels contains a multiline string with additional labels to add to the container label file.
# See `../templates/labels.j2` for details.
#
# Example:
# headplane_container_labels_additional_labels: |
#   my.label=1
#   another.label="here"
headplane_container_labels_additional_labels: ''

# headplane_environment_variables_additional_variables contains a multiline string with additional environment variables to pass to the container.
#
# Example:
# headplane_environment_variables_additional_variables: |
#   VAR=1
#   ANOTHER=value
headplane_environment_variables_additional_variables: ''

# A list of additional "volumes" to mount in the container.
#
# See the `--mount` documentation for the `docker run` command.
#
# Example:
# headplane_container_additional_volumes:
#   - type: bind
#     src: /path/on/the/host
#     dst: /data
#   - type: bind
#     src: /another-path/on/the/host
#     dst: /read-only
#     options: readonly
headplane_container_additional_volumes: []

# A list of extra arguments to pass to the container
headplane_container_extra_arguments: []

# Default Headplane configuration template which covers the generic use case.
# You can customize it by controlling the various variables inside it.
#
# For a more advanced customization, you can extend the default (see `headplane_configuration_extension_yaml`)
# or completely replace this variable with your own template.
headplane_configuration_yaml: "{{ lookup('template', 'templates/config.yaml.j2') }}"

headplane_configuration_extension_yaml: |
  # Your custom YAML configuration for Headplane goes here.
  # This configuration extends the default starting configuration (`headplane_configuration_yaml`).
  #
  # You can override individual variables from the default configuration, or introduce new ones.
  #
  # If you need something more special, you can take full control by
  # completely redefining `headplane_configuration_yaml`.
  #
  # Example configuration extension follows:
  #
  # acme_url: https://acme-v02.api.letsencrypt.org/directory
  # acme_email: "alice@example.com"

headplane_configuration_extension: "{{ headplane_configuration_extension_yaml | from_yaml if headplane_configuration_extension_yaml | from_yaml is mapping else {} }}"

# Holds the final Headplane configuration (a combination of the default and its extension).
# You most likely don't need to touch this variable. Instead, see `headplane_configuration_yaml`.
headplane_configuration: "{{ headplane_configuration_yaml | from_yaml | combine(headplane_configuration_extension, recursive=true) }}"
